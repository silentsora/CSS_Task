<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JS-task4-3</title>
    <link href="task2.css" rel="stylesheet" type="text/css">
</head>
<body>
<div class="header">
    <span>黑夜解密</span>
    <a href=""><img class="icon1" src="img-js-task2/menu.png"></a>
    <a href="task2-1.html"><img class="icon2" src="img-js-task2/close.png"></a>
</div>
<div class="content2">
    <img class="cry" src="img-js-task2/dead.png">
    <div id="result"></div>
</div>
<div class="footer">
    <div id="step1" class="step2">亡灵发表遗言</div>
    <div id="step2" class="step2">玩家依次发言讨论</div>
    <button id="submit" onclick="vote()">去投票</button>
</div>
<script>
    var temp=localStorage;
    var job=JSON.parse(temp.getItem("jobs"));
    var action=new Array;
    action=JSON.parse(temp.getItem("action"));
    var whoKill=new Array;      //存储杀人者的数组
    if(temp.getItem("whoKill")){        //如果有杀人记录则读取
        whoKill=JSON.parse(temp.getItem("whoKill"));
        console.log("有whoKill存储");
    }
    var whoBeKill=new Array;        //存储被杀者的数组
    if(temp.getItem("whoBeKill")){      //如果有被杀记录则读取
        whoBeKill=JSON.parse(temp.getItem("whoBeKill"));
        console.log("有whoBeKill存储");
    }
    console.log(temp.getItem("checked"));
    whoBeKill.push(parseInt(temp.getItem("checked")));  //将上次选择杀的对象添加到whoBeKill数组里
    console.log(action,whoKill);
    if(action[action.length-1]=="killer"){
        if(whoKill[whoKill.length-1]!="杀手杀"){       //防止刷新重复杀人
            whoKill.push("杀手杀");
        }
        console.log(whoKill);
    }
    if(action[action.length-1]=="people"){
        if(whoKill[whoKill.length-1]!="投票投"){       //防止刷新重复投人
            whoKill.push("投票投");
        }
        document.getElementById("step1").style.display="none";      //将页面改变成投票的样式
        document.getElementById("step2").style.display="none";
        document.getElementById("submit").innerHTML="第二天";
    }
    for(var i=0;i<action.length;i++){       //输出杀人报告
        var decrypt=document.createElement("span");
        decrypt.innerHTML=whoBeKill[i]+1+"号被"+whoKill[i]+"死了,真实身份是"+job[whoBeKill[i]]+"<br>";
        document.getElementById("result").appendChild(decrypt);
    }
    temp.setItem("whoKill",JSON.stringify(whoKill));        //存储杀人数据
    temp.setItem("whoBeKill",JSON.stringify(whoBeKill));
    function vote(){
        if(action[action.length-1]=="people"){      //进入第二天
            alert("第二天往后的部分尚未完成");
            return;
        }
        console.log(action);
        action.push("people");      //表明接下来是投票阶段,存储该参数
        var actionJSON=JSON.stringify(action);
        temp.setItem("action",actionJSON);
        location.href="task4-1.html";
    }
</script>
</body>
</html>